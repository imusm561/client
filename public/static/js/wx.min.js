const scriptParams=new URLSearchParams(document.currentScript.src.split("?")[1]),appid=scriptParams.get("appid"),scope=scriptParams.get("scope"),searchParams=new URLSearchParams(window.location.search),code=searchParams.get("code"),state=searchParams.get("state"),redirect=()=>{let e=new URL(window.location.href);e.searchParams.delete("code"),e.searchParams.delete("state");let t=encodeURIComponent(e.toString());window.location.href=`https://open.weixin.qq.com/connect/oauth2/authorize?appid=${appid}&redirect_uri=${t}&response_type=code&scope=${scope}&state=STATE#wechat_redirect`};null!==appid&&null!==scope&&(null===code||null===state)&&redirect();const getWeixinUserInfo=e=>{if(null!==appid&&null!==scope&&null!==code&&null!==state){let t=new URLSearchParams;t.append("appid",appid),t.append("code",code),fetch(`https://www.imusm.cn/lcdp/cor/weixin/authorize?${t.toString()}`).then(e=>e.json()).then(t=>{200===t.code?e&&e(t.data):(console.log(t),redirect())}).catch(e=>{console.error(e),redirect()})}else redirect()};